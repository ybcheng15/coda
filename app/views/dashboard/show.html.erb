<div class="flex flex-row h-screen w-full">
  <!-- Profile and playback stuff-->  
  <div class="flex flex-1 flex-col h-full bg-black1 items-center justify-center p-4">
    
    <!-- spin? -->
    <!-- <%= image_tag @top_artists['items'].first['images'].first['url'], class: "absolute w-200 h-200 rounded-full mx-auto mb-2" %> -->
    
    
    <div class="relative">
    <!-- profile pic circle -->
      <div class="w-75 h-75 rounded-full object-cover border-4 border-white shadow-md bg-gray-300">
        <% if not @profile["images"].empty? %>
          <%= image_tag @profile["images"].first["url"], class: "w-full h-full rounded-full object-cover" %>
        <% else %>
          <%= image_tag "default_profile.jpg", class: "w-full h-full rounded-full object-cover" %>
        <% end %>
      </div>

      <div class="w-75 h-75 rounded-full object-cover border-4 border-white shadow-md bg-gray-300">
      </div>


      <div class="absolute mt-10 w-75 h-25 bg-white rounded-lg">
        <% if @playback_state %>
          <p class="font-medium text-sm truncate"><%= @playback_state["item"]["name"] %></p>
          <p class="text-xs text-gray-600 truncate">
            <%= @playback_state["item"]["artists"].map { |artist| artist["name"] }.join(", ") %>
          </p>
        <% else %>
          <p class="font-medium text-sm truncate">No track is currently playing.</p>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Top artists -->
  <div class="flex flex-1 flex-col h-full bg-black1 items-center justify-center p-4">

    <h1 class="text-2xl text-center text-white mb-4">Your Top Artists</h1>
    

    <div class="relative flex flex-col w-130 h-170 bg-black1 overflow-y-auto scrollbar-hidden border-2 border-gray1 shadow-md shadow-gray1 rounded-4xl">
      <!-- top 3 artists display -->
      <div class="flex flex-1 h-full w-full text-white text-center items-center justify-center space-x-5 p-5 rounded-t-4xl">
        <% if @top_artists %>
          <!-- #2 Artist (Left) -->
          <div class="flex flex-col items-center">
            <div class="w-30 h-30 rounded-full border-4 border-slate-400 shadow-lg shadow-gray1 overflow-hidden">
              <img src="<%= @top_artists['items'][1]['images'].first['url'] %>" class="w-full h-full object-cover" title="<%= @top_artists['items'][1]['name'] %>">
            </div>
          </div>

          <!-- #1 Artist (Middle) -->
          <div class="flex flex-col items-center">
            <div class="w-50 h-50 rounded-full border-2 border-amber-300 shadow-lg shadow-gray1 overflow-hidden">
              <img src="<%= @top_artists['items'][0]['images'].first['url'] %>" class="w-full h-full object-cover" title="<%= @top_artists['items'][0]['name'] %>">
            </div>
          </div>

          <!-- #3 Artist (Right) -->
          <div class="flex flex-col items-center">
            <div class="w-30 h-30 rounded-full border-2 border-amber-800 shadow-lg shadow-gray1 overflow-hidden">
              <img src="<%= @top_artists['items'][2]['images'].first['url'] %>" class="w-full h-full object-cover" title="<%= @top_artists['items'][2]['name'] %>">
            </div>
          </div>
        <% end %>
      </div>


      <!-- Full list of top artists -->
      <% if @top_artists %>
        <% @top_artists['items'].each_with_index do |artist, index| %>
          <!-- Artist card -->
          <div class="rounded-xl">
            <!-- Content overlay -->
            <div class="flex items-center space-x-4 p-4">
              <!-- Order number -->
              <div class="text-white text-xs rounded-full">
                <%= index + 1 %>
              </div>
              <!-- Circular Artist Image -->
              <img src="<%= artist['images'].first['url'] %>"
                  alt="Artist"
                  class="w-20 h-20 rounded-full border-0 shadow-lg shadow-gray1">
              <div class="text-gray-100">
                <h2 class="text-xl"><%= artist['name'] %></h2>
                <p class="text-xs opacity-50">Genre: <%= artist['genres'].join(', ') %></p>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>





  <!-- Top tracks -->
  <div class="flex flex-1 flex-col h-full bg-black1 items-center justify-center p-4">
    <h1 class="text-2xl text-center text-white mb-4">Your Top Tracks</h1>


      <div class="relative flex flex-col w-130 h-170 bg-black1 overflow-y-auto scrollbar-hidden border-2 border-gray1 rounded-4xl">
        <!-- top 3 tracks display -->
        <div class="flex flex-1 h-full w-full text-white text-center items-center justify-center space-x-5 p-5 rounded-t-4xl">
          <% if @top_tracks %>
            <!-- #2 Track (Left) -->
            <div class="flex flex-col items-center w-32">
              <div class="w-30 h-30 border-2 border-slate-400 shadow-lg shadow-gray1 overflow-hidden">
                <img src="<%= @top_tracks['items'][1]['album']['images'].first['url'] %>" class="w-full h-full object-cover" title="<%= @top_tracks['items'][1]['name'] %> - <%= @top_tracks['items'][1]['artists'].map { |artist| artist['name'] }.join(', ') %>">
              </div>
            </div>
            <!-- #1 Track (Middle) -->
            <div class="flex flex-col items-center w-50">
              <div class="w-50 h-50 border-2 border-amber-300 shadow-lg shadow-gray1 overflow-hidden">
                <img src="<%= @top_tracks['items'][0]['album']['images'].first['url'] %>"class="w-full h-full object-cover" title="<%= @top_tracks['items'][0]['name'] %> - <%= @top_tracks['items'][0]['artists'].map { |artist| artist['name'] }.join(', ') %>">
              </div>
            </div>
            <!-- #3 Track (Right) -->
            <div class="flex flex-col items-center w-32">
              <div class="w-30 h-30 border-2 border-amber-800 shadow-lg shadow-gray1 overflow-hidden">
                <img src="<%= @top_tracks['items'][2]['album']['images'].first['url'] %>"class="w-full h-full object-cover" title="<%= @top_tracks['items'][2]['name'] %> - <%= @top_tracks['items'][2]['artists'].map { |artist| artist['name'] }.join(', ') %>">
              </div>
            </div>
          <% end %>
        </div>
        <!-- Full list of top tracks -->
        <% if @top_tracks %>
          <% @top_tracks['items'].each_with_index do |track, index| %>
            <!-- Track card -->
            <div class="rounded-xl">
              <!-- Content overlay -->
              <div class="flex items-center space-x-4 p-4">
                <!-- Order number -->
                <div class="text-white text-xs rounded-full">
                  <%= index + 1 %>
                </div>
                <!-- Track Image -->
                <img src="<%= track['album']['images'].first['url'] %>"
                    alt="Track"
                    class="w-20 h-20 border-0 shadow-md shadow-gray1">
                <div class="text-white">
                  <h2 class="text-xl"><%= track['name'] %></h2>
                  <p class="text-xs opacity-50"><%= track['artists'].map { |artist| artist['name'] }.join(', ') %></p>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>

  </div>



<% if not @current_user %>
<h1 class="text-4xl font-bold text-center text-green-600">Welcome, <%= @current_user["name"] %>!</h1>
<div class="text-center mb-6">
  <% if not @profile["images"].empty? %>
    <%= image_tag @profile["images"].first["url"], class: "w-32 h-32 rounded-full mx-auto mt-4" %>
  <% else %>
    <h1 class="text-xl font-semibold mt-4">No Profile Image Available</h1>
  <% end %>
</div>
<%= button_to "Logout", "/logout", method: :delete %>

<% if @playback_state %>
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Currently Playing</h2>
    <% if @playback_state["item"] %>
      <div class="flex items-center space-x-4">
        <%= image_tag @playback_state["item"]["album"]["images"].last["url"], class: "w-24 h-24 rounded-full" %>
        <div>
          <p class="font-medium text-lg"><%= @playback_state["item"]["name"] %></p>
          <p class="text-gray-600"><%= @playback_state["item"]["artists"].map { |artist| artist["name"] }.join(", ") %></p>
          <p class="text-sm text-gray-500">Album: <%= @playback_state["item"]["album"]["name"] %></p>
        </div>
      </div>
    <% else %>
      <p class="text-gray-600">No track is currently playing.</p>
    <% end %>
  </div>
<% end %>


<% if @top_artists %>
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Your Top Artists</h2>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
      
      <% @top_artists['items'].each do |artist| %>
        <div class="text-center">
          <%= image_tag artist['images'].last['url'], class: "w-24 h-24 rounded-full mx-auto mb-2" %>
          <p class="font-medium text-sm truncate"><%= artist['name'] %></p>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<% if @top_tracks %>
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <h2 class="text-xl font-semibold mb-4">Your Top Tracks</h2>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
      <% @top_tracks['items'].each do |track| %>
        <div class="text-center">
          <%= image_tag track['album']['images'].last['url'], class: "w-24 h-24 rounded-full mx-auto mb-2" %>
          <p class="font-medium text-sm truncate"><%= track['name'] %></p>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<% end %>